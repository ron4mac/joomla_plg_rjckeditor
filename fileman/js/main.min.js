var fileTypeIcons={"3gp":"file_extension_3gp.png","7z":"file_extension_7z.png",ace:"file_extension_ace.png",ai:"file_extension_ai.png",aif:"file_extension_aif.png",aiff:"file_extension_aiff.png",amr:"file_extension_amr.png",asf:"file_extension_asf.png",asx:"file_extension_asx.png",avi:"file_extension_avi.png",bat:"file_extension_bat.png",bin:"file_extension_bin.png",bmp:"file_extension_bmp.png",bup:"file_extension_bup.png",cab:"file_extension_cab.png",cbr:"file_extension_cbr.png",cda:"file_extension_cda.png",
cdl:"file_extension_cdl.png",cdr:"file_extension_cdr.png",chm:"file_extension_chm.png",dat:"file_extension_dat.png",divx:"file_extension_divx.png",dll:"file_extension_dll.png",dmg:"file_extension_dmg.png",doc:"file_extension_doc.png",dss:"file_extension_dss.png",dvf:"file_extension_dvf.png",dwg:"file_extension_dwg.png",eml:"file_extension_eml.png",eps:"file_extension_eps.png",exe:"file_extension_exe.png",fla:"file_extension_fla.png",flv:"file_extension_flv.png",gif:"file_extension_gif.png",gz:"file_extension_gz.png",
hqx:"file_extension_hqx.png",htm:"file_extension_htm.png",html:"file_extension_html.png",ifo:"file_extension_ifo.png",indd:"file_extension_indd.png",iso:"file_extension_iso.png",jar:"file_extension_jar.png",jpeg:"file_extension_jpeg.png",jpg:"file_extension_jpg.png",lnk:"file_extension_lnk.png",log:"file_extension_log.png",m4a:"file_extension_m4a.png",m4b:"file_extension_m4b.png",m4p:"file_extension_m4p.png",m4v:"file_extension_m4v.png",mcd:"file_extension_mcd.png",mdb:"file_extension_mdb.png",mid:"file_extension_mid.png",
mkv:"file_extension_mkv.png",mov:"file_extension_mov.png",mp2:"file_extension_mp2.png",mp3:"file_extension_mp3.png",mp4:"file_extension_mp4.png",mpeg:"file_extension_mpeg.png",mpg:"file_extension_mpg.png",msi:"file_extension_msi.png",mswmm:"file_extension_mswmm.png",ogg:"file_extension_ogg.png",pdf:"file_extension_pdf.png",png:"file_extension_png.png",pps:"file_extension_pps.png",ps:"file_extension_ps.png",psd:"file_extension_psd.png",pst:"file_extension_pst.png",ptb:"file_extension_ptb.png",pub:"file_extension_pub.png",
qbb:"file_extension_qbb.png",qbw:"file_extension_qbw.png",qxd:"file_extension_qxd.png",ram:"file_extension_ram.png",rar:"file_extension_rar.png",rm:"file_extension_rm.png",rmvb:"file_extension_rmvb.png",rtf:"file_extension_rtf.png",sea:"file_extension_sea.png",ses:"file_extension_ses.png",sit:"file_extension_sit.png",sitx:"file_extension_sitx.png",ss:"file_extension_ss.png",swf:"file_extension_swf.png",tgz:"file_extension_tgz.png",thm:"file_extension_thm.png",tif:"file_extension_tif.png",tmp:"file_extension_tmp.png",
torrent:"file_extension_torrent.png",ttf:"file_extension_ttf.png",txt:"file_extension_txt.png",vcd:"file_extension_vcd.png",vob:"file_extension_vob.png",wav:"file_extension_wav.png",wma:"file_extension_wma.png",wmv:"file_extension_wmv.png",wps:"file_extension_wps.png",xls:"file_extension_xls.png",xpi:"file_extension_xpi.png",zip:"file_extension_zip.png"},FileTypes=[];FileTypes.image=["jpg","jpeg","png","gif"];FileTypes.media="avi flv swf wmv mp3 wma mpg mpeg".split(" ");FileTypes.document="doc docx txt rtf pdf xls mdb html htm db".split(" ");
function RoxyUtils(){}RoxyUtils.FixPath=function(a){if(!a)return"";a=a.replace(/\\/g,"");a=a.replace(/\/\//g,"/");return a=a.replace(":/","://")};RoxyUtils.FormatDate=function(a){var b="";try{b=$.format.date(a,RoxyFilemanConf.DATEFORMAT)}catch(c){b=a.toString(),b=b.substr(0,b.indexOf("UTC"))}return b};RoxyUtils.GetPath=function(a){var b="";a=RoxyUtils.FixPath(a);-1<a.indexOf("/")&&(b=a.substring(0,a.lastIndexOf("/")));return b};
RoxyUtils.GetUrlParam=function(a,b){var c="";b||(b=self.location.href);if(-1<b.indexOf("?"))for(b=b.substr(b.indexOf("?")+1),b=b.split("&"),i=0;i<b.length;i++){var d=b[i].split("=");if(d[0]&&d[1]&&d[0]==a){c=d[1];break}}return c};RoxyUtils.GetFilename=function(a){var b=a;a=RoxyUtils.FixPath(a);-1<a.indexOf("/")&&(b=a.substring(a.lastIndexOf("/")+1));return b};
RoxyUtils.MakePath=function(){ret="";if(arguments&&0<arguments.length){for(var a=0;a<arguments.length;a++)ret+=$.isArray(arguments[a])?arguments[a].join("/"):arguments[a],a<arguments.length-1&&(ret+="/");ret=RoxyUtils.FixPath(ret)}return ret};RoxyUtils.GetFileExt=function(a){var b="";a=RoxyUtils.GetFilename(a);-1<a.indexOf(".")&&(b=a.substring(a.lastIndexOf(".")+1));return b};RoxyUtils.FileExists=function(a){var b=!1;$.ajax({url:a,type:"HEAD",async:!1,dataType:"text",success:function(){b=!0}});return b};
RoxyUtils.GetFileIcon=function(a){ret="images/filetypes/unknown.png";fileTypeIcons[RoxyUtils.GetFileExt(a).toLowerCase()]&&(ret="images/filetypes/"+fileTypeIcons[RoxyUtils.GetFileExt(a).toLowerCase()]);return ret};RoxyUtils.GetFileSize=function(a){var b=0;$.ajax({url:a,type:"HEAD",async:!1,success:function(a,d,e){b=e.getResponseHeader("Content-Length")}});b||(b=0);return b};
RoxyUtils.GetFileType=function(a){a=RoxyUtils.GetFileExt(a).toLowerCase();if("png"==a||"jpg"==a||"gif"==a||"jpeg"==a)a="image";return a};RoxyUtils.IsImage=function(a){var b=!1;"image"==RoxyUtils.GetFileType(a)&&(b=!0);return b};RoxyUtils.FormatFileSize=function(a){var b="B";a||(a=0);1024<a&&(a/=1024,b="KB");1024<a&&(a/=1024,b="MB");a=new Number(a);return a.toFixed(2)+" "+b};RoxyUtils.AddParam=function(a,b,c){return a+=(-1<a.indexOf("?")?"&":"?")+b+"="+encodeURIComponent(c)};
RoxyUtils.SelectText=function(a,b,c){try{var d=document.getElementById(a);if(d.createTextRange){var e=d.createTextRange();e.collapse(!0);e.moveStart("character",b);e.moveEnd("character",c-b);e.select()}else d.setSelectionRange?d.setSelectionRange(b,c):d.selectionStart&&(d.selectionStart=b,d.selectionEnd=c);d.focus()}catch(f){}};function RoxyFilemanConf(){}RoxyUtils.LoadConfig=function(){$.ajax({url:"conf.json",dataType:"json",async:!1,success:function(a){RoxyFilemanConf=a},error:function(a){alert(t("E_LoadingConf"))}})};
function RoxyLang(){}
RoxyUtils.LoadLang=function(){var a="";RoxyFilemanConf.LANG&&"auto"==RoxyFilemanConf.LANG.toLowerCase()?(a=RoxyUtils.GetUrlParam("langCode")?"lang/"+RoxyUtils.GetUrlParam("langCode").substr(0,2).toLowerCase()+".json":"lang/"+(window.navigator.userLanguage||window.navigator.language).substr(0,2)+".json",RoxyUtils.FileExists(a)||(a="")):RoxyFilemanConf.LANG&&(a="lang/"+RoxyFilemanConf.LANG.substr(0,2).toLowerCase()+".json",RoxyUtils.FileExists(a)||(a=""));a||(a="lang/en.json");$.ajax({url:a,dataType:"json",
async:!1,success:function(a){RoxyLang=a},error:function(a){alert("Error loading language file")}})};RoxyUtils.Translate=function(){RoxyUtils.LoadLang();$("[data-lang-t]").each(function(){var a=$(this).attr("data-lang-t");$(this).prop("title",t(a))});$("[data-lang-v]").each(function(){var a=$(this).attr("data-lang-v");$(this).prop("value",t(a))});$("[data-lang]").each(function(){var a=$(this).attr("data-lang");$(this).html(t(a))})};
RoxyUtils.GetCookies=function(){var a={},b=document.cookie.replace(" ",""),b=b.split(";");for(i in b){var c=b[i].split("=");1<c.length&&(a[$.trim(c[0].toString())]=decodeURIComponent($.trim(c[1].toString()))||"")}return a};RoxyUtils.GetCookie=function(a){return RoxyUtils.GetCookies()[a]||""};RoxyUtils.SetCookie=function(a,b,c,d){var e=new Date;c&&e.setTime(e.getTime()+36E5*c);d||(d="/");document.cookie=a+"="+encodeURIComponent(b)+"; path="+d+(c?"; expires="+e.toGMTString():"")};
RoxyUtils.ToBool=function(a){var b=!1;a=a.toString().toLowerCase();if("true"==a||"on"==a||"yes"==a||"1"==a)b=!0;return b};RoxyUtils.UnsetCookie=function(a){document.cookie=a+"=; expires=Thu, 01 Jan 1972 00:00:00 UTC"};function t(a){var b=a;RoxyLang&&RoxyLang[a]&&(b=RoxyLang[a]);return b}
function File(a,b,c,d,e){this.fullPath=a;this.type=RoxyUtils.GetFileType(a);this.name=RoxyUtils.GetFilename(a);this.ext=RoxyUtils.GetFileExt(a);this.path=RoxyUtils.GetPath(a);this.icon=RoxyUtils.GetFileIcon(a);this.bigIcon=this.icon.replace("filetypes","filetypes/big");this.image=a;this.size=b?b:RoxyUtils.GetFileSize(a);this.time=c;this.width=d?d:0;this.height=e?e:0;this.Show=function(){html='<li data-path="'+this.fullPath+'" data-time="'+this.time+'" data-icon="'+this.icon+'" data-w="'+this.width+
'" data-h="'+this.height+'" data-size="'+this.size+'" data-icon-big="'+(this.IsImage()?this.fullPath:this.bigIcon)+'" title="'+this.name+'">';html+='<img src="'+this.icon+'" class="icon">';html+='<span class="time">'+RoxyUtils.FormatDate(new Date(1E3*this.time))+"</span>";html+='<span class="name">'+this.name+"</span>";html+='<span class="size">'+RoxyUtils.FormatFileSize(this.size)+"</span>";html+="</li>";$("#pnlFileList").append(html);var a=$("#pnlFileList li:last");RoxyFilemanConf.MOVEFILE&&a.draggable({helper:makeDragFile,
start:startDragFile,cursorAt:{left:10,top:10},delay:200});a.click(function(a){selectFile(this)});a.dblclick(function(a){selectFile(this);setFile()});a.tooltip({show:{delay:700},track:!0,content:tooltipContent});a.bind("contextmenu",function(a){a.stopPropagation();a.preventDefault();closeMenus("dir");selectFile(this);$(this).tooltip("close");var b=a.pageY-$("#menuFile").height();0>b&&(b=0);$("#menuFile").css({top:b+"px",left:a.pageX+"px"}).show();return!1})};this.GetElement=function(){return $('li[data-path="'+
this.fullPath+'"]')};this.IsImage=function(){var a=!1;"image"==this.type&&(a=!0);return a};this.Delete=function(){if(RoxyFilemanConf.DELETEFILE){var a=RoxyUtils.AddParam(RoxyFilemanConf.DELETEFILE,"f",this.fullPath),b=this;$.ajax({url:a,type:"POST",data:{f:this.fullPath},dataType:"json",async:!1,success:function(a){if("ok"==a.res.toLowerCase()){if($('li[data-path="'+b.fullPath+'"]').remove(),a=Directory.Parse(b.path))a.files--,a.Update(),a.SetStatusBar()}else alert(a.msg)},error:function(b){alert(t("E_LoadingAjax")+
" "+a)}})}else alert(t("E_ActionDisabled"))};this.Rename=function(a){if(!RoxyFilemanConf.RENAMEFILE)return alert(t("E_ActionDisabled")),!1;if(!a)return!1;var b=RoxyUtils.AddParam(RoxyFilemanConf.RENAMEFILE,"f",this.fullPath),b=RoxyUtils.AddParam(b,"n",a),d=this,e=!1;$.ajax({url:b,type:"POST",data:{f:this.fullPath,n:a},dataType:"json",async:!1,success:function(b){if("ok"==b.res.toLowerCase()){var c=RoxyUtils.MakePath(this.path,a);$('li[data-path="'+d.fullPath+'"] .icon').attr("src",RoxyUtils.GetFileIcon(a));
$('li[data-path="'+d.fullPath+'"] .name').text(a);$('li[data-path="'+c+'"]').attr("data-path",c);e=!0}b.msg&&alert(b.msg)},error:function(a){alert(t("E_LoadingAjax")+" "+b)}});return e};this.Copy=function(a){if(RoxyFilemanConf.COPYFILE){var b=RoxyUtils.AddParam(RoxyFilemanConf.COPYFILE,"f",this.fullPath),b=RoxyUtils.AddParam(b,"n",a),d=!1;$.ajax({url:b,type:"POST",data:{f:this.fullPath,n:a},dataType:"json",async:!1,success:function(b){if("ok"==b.res.toLowerCase()){var e=Directory.Parse(a);e&&(e.files++,
e.Update(),e.SetStatusBar(),e.ListFiles(!0));d=!0}b.msg&&alert(b.msg)},error:function(a){alert(t("E_LoadingAjax")+" "+b)}});return d}alert(t("E_ActionDisabled"))};this.Move=function(a){if(RoxyFilemanConf.MOVEFILE){newFullPath=RoxyUtils.MakePath(a,this.name);var b=RoxyUtils.AddParam(RoxyFilemanConf.MOVEFILE,"f",this.fullPath),b=RoxyUtils.AddParam(b,"n",newFullPath),d=this,e=!1;$.ajax({url:b,type:"POST",data:{f:this.fullPath,n:newFullPath},dataType:"json",async:!1,success:function(b){if("ok"==b.res.toLowerCase()){$('li[data-path="'+
d.fullPath+'"]').remove();var c=Directory.Parse(d.path);c&&(c.files--,c.Update(),c.SetStatusBar(),c=Directory.Parse(a),c.files++,c.Update());e=!0}b.msg&&alert(b.msg)},error:function(a){alert(t("E_LoadingAjax")+" "+b)}});return e}alert(t("E_ActionDisabled"))}}File.Parse=function(a){var b=!1;a=$("#pnlFileList").find('li[data-path="'+a+'"]');0<a.length&&(b=new File(a.attr("data-path"),a.attr("data-size"),a.attr("data-time"),a.attr("data-w"),a.attr("data-h")));return b};
function Directory(a,b,c){a||(a="");this.fullPath=a;this.name=RoxyUtils.GetFilename(a);this.name||(this.name="My files");this.path=RoxyUtils.GetPath(a);this.dirs=b?b:0;this.files=c?c:0;this.filesList=[];this.Show=function(){var a=this.GetHtml(),b;b=$('li[data-path="'+this.path+'"]');0==b.length?b=$("#pnlDirList"):(0==b.children("ul").length&&b.append("<ul></ul>"),b=b.children("ul"));b&&(b.append(a),this.SetEvents())};this.SetEvents=function(){var a=this.GetElement();RoxyFilemanConf.MOVEDIR&&a.draggable({helper:makeDragDir,
start:startDragDir,cursorAt:{left:10,top:10},delay:200});a=a.children("div");a.click(function(a){selectDir(this)});a.bind("contextmenu",function(a){a.stopPropagation();a.preventDefault();closeMenus("file");selectDir(this);var b=a.pageY-$("#menuDir").height();0>b&&(b=0);$("#menuDir").css({top:b+"px",left:a.pageX+"px"}).show();return!1});a.droppable({drop:moveObject,over:dragFileOver,out:dragFileOut});a=a.children(".dirPlus");a.click(function(a){a.stopPropagation();Directory.Parse($(this).closest("li").attr("data-path")).Expand()})};
this.GetHtml=function(){var a='<li data-path="'+this.fullPath+'" data-dirs="'+this.dirs+'" data-files="'+this.files+'" class="directory">',a=a+('<div><img src="images/'+(0<this.dirs?"dir-plus.png":"blank.gif")+'" class="dirPlus" width="9" height="9">'),a=a+('<img src="images/folder.png" class="dir"><span class="name">'+this.name+" ("+this.files+")</span></div>");return a+"</li>"};this.SetStatusBar=function(){$("#pnlStatus").html(this.files+" "+(1==this.files?t("file"):t("files")))};this.SetSelectedFile=
function(a){a&&(a=File.Parse(a))&&selectFile(a.GetElement())};this.Select=function(a){var b=this.GetElement();b.children("div").addClass("selected");$('#pnlDirList li[data-path!="'+this.fullPath+'"] > div').removeClass("selected");b.children("img.dir").prop("src","images/folder.png");this.SetStatusBar();for(b=this.GetParent();b;)b.Expand(!0),b=b.GetParent();this.Expand(!0);this.ListFiles(!0,a);setLastDir(this.fullPath)};this.GetElement=function(){return $('li[data-path="'+this.fullPath+'"]')};this.IsExpanded=
function(){var a=this.GetElement().children("ul");return a&&a.is(":visible")};this.IsListed=function(){return $("#hdDir").val()==this.fullPath?!0:!1};this.GetExpanded=function(a){var b=[];a||(a=$("#pnlDirList"));a.children("li").each(function(){var a=$(this).attr("data-path"),d=new Directory(a);d.IsExpanded()&&a&&b.push(a);b=b.concat(d.GetExpanded(d.GetElement().children("ul")))});return b};this.RestoreExpanded=function(a){for(i=0;i<a.length;i++){var b=Directory.Parse(a[i]);b&&b.Expand(!0)}};this.GetParent=
function(){return Directory.Parse(this.path)};this.SetOpened=function(){var a=this.GetElement();1>a.find("li").length?a.children("div").children(".dirPlus").prop("src","images/blank.gif"):this.IsExpanded()?a.children("div").children(".dirPlus").prop("src","images/dir-minus.png"):a.children("div").children(".dirPlus").prop("src","images/dir-plus.png")};this.Update=function(a){var b=this.GetElement();a&&(this.fullPath=a,this.name=RoxyUtils.GetFilename(a),this.name||(this.name="My files"),this.path=
RoxyUtils.GetPath(a));b.attr("data-path",this.fullPath);b.attr("data-dirs",this.dirs);b.attr("data-files",this.files);b.children("div").children(".name").html(this.name+" ("+this.files+")");this.SetOpened()};this.LoadAll=function(a){var b=this.GetExpanded(),c=RoxyFilemanConf.DIRLIST;if(c){$("#pnlLoadingDirs").show();$("#pnlDirList").hide();var c=RoxyUtils.AddParam(c,"type",RoxyUtils.GetUrlParam("type")),d=this;$.ajax({url:c,type:"POST",dataType:"json",async:!1,cache:!1,success:function(c){$("#pnlDirList").children("li").remove();
for(i=0;i<c.length;i++){var e=new Directory(c[i].p,c[i].d,c[i].f);e.Show()}$("#pnlLoadingDirs").hide();$("#pnlDirList").show();d.RestoreExpanded(b);(e=Directory.Parse(a))&&e.Select()},error:function(a){$("#pnlLoadingDirs").hide();$("#pnlDirList").show();alert(t("E_LoadingAjax")+" "+RoxyFilemanConf.DIRLIST)}})}else alert(t("E_ActionDisabled"))};this.Expand=function(a){var b=this.GetElement().children("ul");this.IsExpanded()&&!a?b.hide():b.show();this.SetOpened()};this.Create=function(a){if(!a)return!1;
if(RoxyFilemanConf.CREATEDIR){var b=RoxyUtils.AddParam(RoxyFilemanConf.CREATEDIR,"d",this.fullPath),b=RoxyUtils.AddParam(b,"n",a),c=this,d=!1;$.ajax({url:b,type:"POST",data:{d:this.fullPath,n:a},dataType:"json",async:!1,cache:!1,success:function(b){"ok"==b.res.toLowerCase()?(c.LoadAll(RoxyUtils.MakePath(c.fullPath,a)),d=!0):alert(b.msg)},error:function(a){alert(t("E_LoadingAjax")+" "+c.name)}});return d}alert(t("E_ActionDisabled"))};this.Delete=function(){if(RoxyFilemanConf.DELETEDIR){var a=RoxyUtils.AddParam(RoxyFilemanConf.DELETEDIR,
"d",this.fullPath),b=this,c=!1;$.ajax({url:a,type:"POST",data:{d:this.fullPath},dataType:"json",async:!1,cache:!1,success:function(a){if("ok"==a.res.toLowerCase()){var d=b.GetParent();d.dirs--;d.Update();d.Select();b.GetElement().remove();c=!0}a.msg&&alert(a.msg)},error:function(a){alert(t("E_LoadingAjax")+" "+b.name)}});return c}alert(t("E_ActionDisabled"))};this.Rename=function(a){if(!a)return!1;if(RoxyFilemanConf.RENAMEDIR){var b=RoxyUtils.AddParam(RoxyFilemanConf.RENAMEDIR,"d",this.fullPath),
b=RoxyUtils.AddParam(b,"n",a),c=this,d=!1;$.ajax({url:b,type:"POST",data:{d:this.fullPath,n:a},dataType:"json",async:!1,cache:!1,success:function(b){if("ok"==b.res.toLowerCase()){var e=RoxyUtils.MakePath(c.path,a);c.Update(e);c.Select();d=!0}b.msg&&alert(b.msg)},error:function(a){alert(t("E_LoadingAjax")+" "+c.name)}});return d}alert(t("E_ActionDisabled"))};this.Copy=function(a){if(RoxyFilemanConf.COPYDIR){var b=RoxyUtils.AddParam(RoxyFilemanConf.COPYDIR,"d",this.fullPath),b=RoxyUtils.AddParam(b,
"n",a),c=!1;$.ajax({url:b,type:"POST",data:{d:this.fullPath,n:a},dataType:"json",async:!1,cache:!1,success:function(b){if("ok"==b.res.toLowerCase()){var d=Directory.Parse(a);d&&d.LoadAll(d.fullPath);c=!0}b.msg&&alert(b.msg)},error:function(a){alert(t("E_LoadingAjax")+" "+b)}});return c}alert(t("E_ActionDisabled"))};this.Move=function(a){if(!a)return!1;if(RoxyFilemanConf.MOVEDIR){var b=RoxyUtils.AddParam(RoxyFilemanConf.MOVEDIR,"d",this.fullPath),b=RoxyUtils.AddParam(b,"n",a),c=this,d=!1;$.ajax({url:b,
type:"POST",data:{d:this.fullPath,n:a},dataType:"json",async:!1,cache:!1,success:function(b){"ok"==b.res.toLowerCase()&&(c.LoadAll(RoxyUtils.MakePath(a,c.name)),d=!0);b.msg&&alert(b.msg)},error:function(a){alert(t("E_LoadingAjax")+" "+c.name)}});return d}alert(t("E_ActionDisabled"))};this.ListFiles=function(a,b){$("#pnlLoading").show();$("#pnlEmptyDir").hide();$("#pnlFileList").hide();$("#pnlSearchNoFiles").hide();this.LoadFiles(a,b)};this.FilesLoaded=function(a,b){a=this.SortFiles(a);$("#pnlFileList").html("");
for(i=0;i<a.length;i++)a[i].Show();$("#hdDir").val(this.fullPath);$("#pnlLoading").hide();0==$("#pnlFileList").children("li").length&&$("#pnlEmptyDir").show();this.files=$("#pnlFileList").children("li").length;this.Update();this.SetStatusBar();filterFiles();switchView();$("#pnlFileList").show();this.SetSelectedFile(b)};this.LoadFiles=function(a,b){if(RoxyFilemanConf.FILESLIST){var c=[],d=RoxyFilemanConf.FILESLIST,d=RoxyUtils.AddParam(d,"d",this.fullPath),d=RoxyUtils.AddParam(d,"type",RoxyUtils.GetUrlParam("type")),
e=this;!this.IsListed()||a?$.ajax({url:d,type:"POST",data:{d:this.fullPath,type:RoxyUtils.GetUrlParam("type")},dataType:"json",async:!0,cache:!1,success:function(a){for(i=0;i<a.length;i++)c.push(new File(a[i].p,a[i].s,a[i].t,a[i].w,a[i].h));e.FilesLoaded(c,b)},error:function(a){alert(t("E_LoadingAjax")+" "+d)}}):($("#pnlFileList li").each(function(){c.push(new File($(this).attr("data-path"),$(this).attr("data-size"),$(this).attr("data-time"),$(this).attr("data-w"),$(this).attr("data-h")))}),e.FilesLoaded(c,
b));return c}alert(t("E_ActionDisabled"))};this.SortByName=function(a,b){a.sort(function(a,c){var d="desc"==b?0:2;a=a.name.toLowerCase();c=c.name.toLowerCase();return a>c?-1+d:a<c?1-d:0});return a};this.SortBySize=function(a,b){a.sort(function(a,c){var d="desc"==b?0:2;a=parseInt(a.size);c=parseInt(c.size);return a>c?-1+d:a<c?1-d:0});return a};this.SortByTime=function(a,b){a.sort(function(a,c){var d="desc"==b?0:2;a=parseInt(a.time);c=parseInt(c.time);return a>c?-1+d:a<c?1-d:0});return a};this.SortFiles=
function(a){var b=$("#ddlOrder").val();b||(b="name");switch(b){case "size":a=this.SortBySize(a,"asc");break;case "size_desc":a=this.SortBySize(a,"desc");break;case "time":a=this.SortByTime(a,"asc");break;case "time_desc":a=this.SortByTime(a,"desc");break;case "name_desc":a=this.SortByName(a,"desc");break;default:a=this.SortByName(a,"asc")}return a}}
Directory.Parse=function(a){var b=!1;a=$("#pnlDirList").find('li[data-path="'+a+'"]');0<a.length&&(b=new Directory(a.attr("data-path"),a.attr("data-dirs"),a.attr("data-files")));return b};$.ajaxSetup({cache:!1});
function selectFile(a){$("#pnlFileList li").removeClass("selected");$(a).prop("class","selected");var b=RoxyUtils.GetFilename($(a).attr("data-path")),b=b+(" ("+t("Size")+": "+RoxyUtils.FormatFileSize($(a).attr("data-size")));0<$(a).attr("data-w")&&(b+=", "+t("Dimensions")+":"+$(a).attr("data-w")+"x"+$(a).attr("data-h"));b+=")";$("#pnlStatus").html(b)}function getLastDir(){return RoxyUtils.GetCookie("roxyld")}function setLastDir(a){RoxyUtils.SetCookie("roxyld",a,10)}
function selectDir(a){(a=Directory.Parse($(a).parent("li").attr("data-path")))&&a.Select()}function startDragDir(){}function startDragFile(){selectFile(this)}function dragFileOver(){$(this).children("img.dir").attr("src","images/folder-green.png")}function dragFileOut(){$("#pnlDirList").find("img.dir").attr("src","images/folder.png")}
function makeDragFile(a){a=new File($(a.target).closest("li").attr("data-path"));return'<div class="pnlDragFile" data-path="'+a.fullPath+'"><img src="'+a.bigIcon+'" align="absmiddle">&nbsp;'+a.name+"</div>"}function makeDragDir(a){a=new Directory($(a.target).attr("data-path")?$(a.target).attr("data-path"):$(a.target).closest("li").attr("data-path"));return'<div class="pnlDragDir" data-path="'+a.fullPath+'"><img src="images/folder.png" align="absmiddle">&nbsp;'+a.name+"</div>"}
function moveDir(a,b,c){a=Directory.Parse(b.draggable.attr("data-path"));c=Directory.Parse($(c).parent("li").attr("data-path"));c.fullPath!=a.path&&a.Move(c.fullPath)}function moveFile(a,b,c){a=new File(b.draggable.attr("data-path"));c=Directory.Parse($(c).parent("li").attr("data-path"));Directory.Parse(a.path);a.path!=c.fullPath&&a.Move(c.fullPath)}function moveObject(a,b){a.stopPropagation();b.draggable.hasClass("directory")?moveDir(a,b,this):moveFile(a,b,this);dragFileOut()}
function clickFirstOnEnter(a){$("#"+a).unbind("keypress");$(".actions input").each(function(){this.blur()});$("#"+a).keypress(function(a){a.keyCode==$.ui.keyCode.ENTER&&(a.stopPropagation(),$(this).parent().find(".ui-dialog-buttonset button").eq(0).trigger("click"))})}
function addDir(){var a=getSelectedDir();if(a){clickFirstOnEnter("pnlDirName");$("#txtDirName").val("");var b={};b[t("CreateDir")]=function(){var b=$.trim($("#txtDirName").val());b||alert(t("E_MissingDirName"));a.Create(b)&&$("#pnlDirName").dialog("close")};b[t("Cancel")]=function(){$("#pnlDirName").dialog("close")};$("#pnlDirName").dialog({title:t("T_CreateDir"),modal:!0,buttons:b})}}var uploadFileList=[];
function showUploadList(a){var b=$("#uploadFilesList");b.html("");clearFileField();for(i=0;i<a.length;i++)b.append('<div class="fileUpload"><div class="fileName">'+a[i].name+" ("+RoxyUtils.FormatFileSize(a[i].size)+')<span class="progressPercent"></span><div class="uploadProgress"><div class="stripes"></div></div></div><a class="removeUpload" onclick="removeUpload('+i+')"></a></div>');0<a.length?$("#btnUpload").button("enable"):$("#btnUpload").button("disable")}
function listUploadFiles(a){window.FileList?0<a.length&&(uploadFileList=[],addUploadFiles(a)):$("#btnUpload").button("enable")}function addUploadFiles(a){for(i=0;i<a.length;i++)uploadFileList.push(a[i]);showUploadList(uploadFileList)}function removeUpload(a){findUploadElement(a).remove();try{uploadFileList.splice(a,1),showUploadList(uploadFileList)}catch(b){}}function findUploadElement(a){return $("#uploadFilesList .fileUpload:eq("+a+")")}
function updateUploadProgress(a,b){var c=findUploadElement(b),d=99;a.lengthComputable&&(d=Math.floor(a.loaded/a.total*100));99<d&&(d=99);c.find(".uploadProgress").css("width",d+"%");c.find(".progressPercent").html(" - "+d+"%")}function uploadComplete(a,b){uploadFinished(a,b,"ok")}function uploadError(a,b){setUploadError(b);uploadFinished(a,b,"error")}
function setUploadError(a){a=findUploadElement(a);a.find(".uploadProgress").css("width","100%").addClass("uploadError").removeClass("uploadComplete");a.find(".progressPercent").html(' - <span class="error">'+t("E_UploadingFile")+"</span>")}function setUploadSuccess(a){a=findUploadElement(a);a.find(".uploadProgress").css("width","100%").removeClass("uploadError").addClass("uploadComplete");a.find(".progressPercent").html(" - 100%")}function uploadCanceled(a,b){uploadFinished(a,b,"error")}
function uploadFinished(a,b,c){var d=findUploadElement(b),e=null;try{e=JSON.parse(a.target.responseText)}catch(f){}e&&"error"==e.res||"ok"!=c?(c="error",setUploadError(b)):(c="ok",setUploadSuccess(b));d.attr("data-ulpoad",c);checkUploadResult()}
function checkUploadResult(){var a=$("#uploadFilesList .fileUpload").length,b=$("#uploadFilesList .fileUpload[data-ulpoad]").length;$('#uploadFilesList .fileUpload[data-ulpoad="ok"]');b==a&&(uploadFileList=[],Directory.Parse($("#hdDir").val()).ListFiles(!0),$("#btnUpload").button("disable"))}
function fileUpload(a,b){var c=new XMLHttpRequest,d=new FormData;findUploadElement(b).find(".removeUpload").remove();d.append("action","upload");d.append("method","ajax");d.append("d",$("#hdDir").attr("value"));d.append("files[]",a);c.upload.addEventListener("progress",function(a){updateUploadProgress(a,b)},!1);c.addEventListener("load",function(a){uploadComplete(a,b)},!1);c.addEventListener("error",function(a){uploadError(a,b)},!1);c.addEventListener("abort",function(a){uploadCanceled(a,b)},!1);
c.open("POST",RoxyFilemanConf.UPLOAD,!0);c.setRequestHeader("Accept","*/*");c.send(d)}function dropFiles(a,b){a&&a.dataTransfer&&a.dataTransfer.files?(addFile(),b?addUploadFiles(a.dataTransfer.files):listUploadFiles(a.dataTransfer.files)):addFile()}function clearFileField(a){a||(a="#fileUploads");try{$(a).val(""),$(a).val(null)}catch(b){}}function addFileClick(){$("#uploadResult").html("");showUploadList([]);addFile()}
function addFile(){clickFirstOnEnter("dlgAddFile");$("#uploadResult").html("");clearFileField();var a={};a[t("Upload")]={id:"btnUpload",text:t("Upload"),disabled:!0,click:function(){if($("#fileUploads").val()||uploadFileList&&0!=uploadFileList.length)if(RoxyFilemanConf.UPLOAD)if(window.FormData&&window.XMLHttpRequest&&window.FileList&&uploadFileList&&0<uploadFileList.length)for(i=0;i<uploadFileList.length;i++)fileUpload(uploadFileList[i],i);else document.forms.addfile.action=RoxyFilemanConf.UPLOAD,
document.forms.addfile.submit();else alert(t("E_ActionDisabled"));else alert(t("E_SelectFiles"))}};a[t("Cancel")]=function(){$("#dlgAddFile").dialog("close")};$("#dlgAddFile").dialog({title:t("T_AddFile"),modal:!0,buttons:a,width:400})}
function fileUploaded(a){if("ok"==a.res&&a.msg){$("#dlgAddFile").dialog("close");var b=Directory.Parse($("#hdDir").val());b.ListFiles(!0);alert(a.msg)}else"ok"==a.res?($("#dlgAddFile").dialog("close"),b=Directory.Parse($("#hdDir").val()),b.ListFiles(!0)):alert(a.msg)}
function renameDir(){var a=getSelectedDir();if(a)if(1>$('[data-path="'+a.fullPath+'"]').parents("li").length)alert(t("E_CannotRenameRoot"));else{clickFirstOnEnter("pnlDirName");$("#txtDirName").val(a.name);var b={};b[t("RenameDir")]=function(){var b=$.trim($("#txtDirName").val());b||alert(t("E_MissingDirName"));a.Rename(b)&&$("#pnlDirName").dialog("close")};b[t("Cancel")]=function(){$("#pnlDirName").dialog("close")};$("#pnlDirName").dialog({title:t("T_RenameDir"),modal:!0,buttons:b});RoxyUtils.SelectText("txtDirName",
0,(new String(a.name)).length)}}
function renameFile(){var a=getSelectedFile();if(a){clickFirstOnEnter("pnlRenameFile");$("#txtFileName").val(a.name);var b={};b[t("RenameFile")]=function(){var b=$.trim($("#txtFileName").val());b?a.Rename(b)&&($('li[data-path="'+a.fullPath+'"] .name').text(b),$('li[data-path="'+a.fullPath+'"]').attr("data-path",RoxyUtils.MakePath(a.path,b)),$("#pnlRenameFile").dialog("close")):alert("Missing file name")};b[t("Cancel")]=function(){$("#pnlRenameFile").dialog("close")};$("#pnlRenameFile").dialog({title:t("T_RenameFile"),
modal:!0,buttons:b});0<a.name.lastIndexOf(".")&&RoxyUtils.SelectText("txtFileName",0,a.name.lastIndexOf("."))}}function getSelectedFile(){var a=null;0<$("#pnlFileList .selected").length&&(a=new File($("#pnlFileList .selected").attr("data-path")));return a}function getSelectedDir(){var a=null;$("#pnlDirList .selected")&&(a=Directory.Parse($("#pnlDirList .selected").closest("li").attr("data-path")));return a}
function deleteDir(a){(a=a?Directory.Parse(a):getSelectedDir())&&confirm(t("Q_DeleteFolder"))&&a.Delete()}function deleteFile(){var a=getSelectedFile();a&&confirm(t("Q_DeleteFile"))&&a.Delete()}function previewFile(){var a=getSelectedFile();a&&window.open(a.fullPath)}
function downloadFile(){var a=getSelectedFile();a&&RoxyFilemanConf.DOWNLOAD?(a=RoxyUtils.AddParam(RoxyFilemanConf.DOWNLOAD,"f",a.fullPath),window.frames.frmUploadFile.location.href=a):RoxyFilemanConf.DOWNLOAD||alert(t("E_ActionDisabled"))}function downloadDir(){var a=getSelectedDir();a&&RoxyFilemanConf.DOWNLOADDIR?(a=RoxyUtils.AddParam(RoxyFilemanConf.DOWNLOADDIR,"d",a.fullPath),window.frames.frmUploadFile.location.href=a):RoxyFilemanConf.DOWNLOAD||alert(t("E_ActionDisabled"))}
function closeMenus(a){a&&"dir"!=a||$("#menuDir").fadeOut();a&&"file"!=a||$("#menuFile").fadeOut()}function selectFirst(){var a=$("#pnlDirList li:first").children("div").first();0<a.length?selectDir(a):window.setTimeout("selectFirst()",300)}
function tooltipContent(){if($("#menuFile").is(":visible"))return"";var a;a=File.Parse($(this).attr("data-path"));"thumb"==$("#hdViewType").val()&&a.IsImage()?a=a.fullPath+'<br><span class="filesize">'+t("Size")+": "+RoxyUtils.FormatFileSize(a.size)+" "+t("Dimensions")+": "+a.width+"x"+a.height+"</span>":a.IsImage()?(RoxyFilemanConf.GENERATETHUMB?(imgUrl=RoxyUtils.AddParam(RoxyFilemanConf.GENERATETHUMB,"f",a.fullPath),imgUrl=RoxyUtils.AddParam(imgUrl,"width",RoxyFilemanConf.PREVIEW_THUMB_WIDTH),imgUrl=
RoxyUtils.AddParam(imgUrl,"height",RoxyFilemanConf.PREVIEW_THUMB_HEIGHT)):imgUrl=a.fullPath,a='<img src="'+imgUrl+'" class="imgPreview"><br>'+a.name+' <br><span class="filesize">'+t("Size")+": "+RoxyUtils.FormatFileSize(a.size)+" "+t("Dimensions")+": "+a.width+"x"+a.height+"</span>"):a=a.fullPath+' <span class="filesize">'+t("Size")+": "+RoxyUtils.FormatFileSize(a.size)+"</span>";return a}
function filterFiles(){var a=$("#txtSearch").val();$("#pnlSearchNoFiles").hide();if(0!=$("#pnlFileList li").length)if(a){var b=0;$("#pnlFileList li").each(function(){-1<$(this).children(".name").text().toLowerCase().indexOf(a.toLowerCase())?(b++,$(this).show()):($(this).removeClass("selected"),$(this).hide())});0==b&&$("#pnlSearchNoFiles").show()}else $("#pnlFileList li").show()}function sortFiles(){var a=getSelectedDir();a&&(a.ListFiles(),filterFiles(),switchView($("#hdViewType").val()))}
function switchView(a){if(a!=$("#hdViewType").val()){a||(a=$("#hdViewType").val());$(".btnView").removeClass("selected");if("thumb"==a){$("#pnlFileList .icon").attr("src","images/blank.gif");$("#pnlFileList").addClass("thumbView");if(0==$("#dynStyle").length){$("head").append('<style id="dynStyle" />');var b="ul#pnlFileList.thumbView li{width:"+RoxyFilemanConf.THUMBS_VIEW_WIDTH+"px;}",b=b+("ul#pnlFileList.thumbView li{height:"+(parseInt(RoxyFilemanConf.THUMBS_VIEW_HEIGHT)+20)+"px;}"),b=b+("ul#pnlFileList.thumbView .icon{width:"+
RoxyFilemanConf.THUMBS_VIEW_WIDTH+"px;}"),b=b+("ul#pnlFileList.thumbView .icon{height:"+RoxyFilemanConf.THUMBS_VIEW_HEIGHT+"px;}");$("#dynStyle").html(b)}$("#pnlFileList li").each(function(){var a=$(this).attr("data-icon-big");RoxyFilemanConf.GENERATETHUMB&&RoxyUtils.IsImage($(this).attr("data-path"))&&(a=RoxyUtils.AddParam(RoxyFilemanConf.GENERATETHUMB,"f",a),a=RoxyUtils.AddParam(a,"width",RoxyFilemanConf.THUMBS_VIEW_WIDTH),a=RoxyUtils.AddParam(a,"height",RoxyFilemanConf.THUMBS_VIEW_HEIGHT));$(this).children(".icon").css("background-image",
"url("+a+")");$(this).tooltip("option","show",{delay:50})});$("#btnThumbView").addClass("selected")}else $("#pnlFileList").removeClass("thumbView"),$("#pnlFileList li").each(function(){$(this).children(".icon").css("background-image","").attr("src",$(this).attr("data-icon"));$(this).tooltip("option","show",{delay:500})}),$("#btnListView").addClass("selected");$("#hdViewType").val(a);RoxyUtils.SetCookie("roxyview",a,10)}}var clipBoard=null;function Clipboard(a,b){this.action=a;this.obj=b}
function cutDir(){var a=getSelectedDir();a&&(setClipboard("cut",a),a.GetElement().addClass("pale"))}function copyDir(){var a=getSelectedDir();a&&setClipboard("copy",a)}function cutFile(){var a=getSelectedFile();a&&(setClipboard("cut",a),a.GetElement().addClass("pale"))}function copyFile(){var a=getSelectedFile();a&&setClipboard("copy",a)}
function pasteToFiles(a,b){if($(b).hasClass("pale"))return a.stopPropagation(),!1;var c=getSelectedDir();c||(c=Directory.Parse($("#pnlDirList li:first").children("div").first()));c&&clipBoard&&clipBoard.obj&&("copy"==clipBoard.action?clipBoard.obj.Copy(c.fullPath):(clipBoard.obj.Move(c.fullPath),clearClipboard()));return!0}
function pasteToDirs(a,b){if($(b).hasClass("pale"))return a.stopPropagation(),!1;var c=getSelectedDir();c||(c=Directory.Parse($("#pnlDirList li:first").children("div").first()));clipBoard&&c?"copy"==clipBoard.action?clipBoard.obj.Copy(c.fullPath):(clipBoard.obj.Move(c.fullPath),clearClipboard(),c.ListFiles(!0)):alert("error");return!0}function clearClipboard(){$("#pnlDirList li").removeClass("pale");$("#pnlFileList li").removeClass("pale");clipBoard=null;$(".paste").addClass("pale")}
function setClipboard(a,b){clearClipboard();b&&(clipBoard=new Clipboard(a,b),$(".paste").removeClass("pale"))}function ResizeLists(){var a=$(window).innerHeight()-$("#fileActions .actions").outerHeight()-$(".bottomLine").outerHeight();$(".scrollPane").css("height",a)}
function removeDisabledActions(){""==RoxyFilemanConf.CREATEDIR&&($("#mnuCreateDir").next().remove(),$("#mnuCreateDir").remove(),$("#btnAddDir").remove());""==RoxyFilemanConf.DELETEDIR&&($("#mnuDeleteDir").prev().remove(),$("#mnuDeleteDir").remove(),$("#btnDeleteDir").remove());""==RoxyFilemanConf.MOVEDIR&&($("#mnuDirCut").next().remove(),$("#mnuDirCut").remove());""==RoxyFilemanConf.COPYDIR&&($("#mnuDirCopy").next().remove(),$("#mnuDirCopy").remove());""==RoxyFilemanConf.COPYDIR&&""==RoxyFilemanConf.MOVEDIR&&
($("#mnuDirPaste").next().remove(),$("#mnuDirPaste").remove());""==RoxyFilemanConf.RENAMEDIR&&($("#mnuRenameDir").next().remove(),$("#mnuRenameDir").remove(),$("#btnRenameDir").remove());""==RoxyFilemanConf.UPLOAD&&$("#btnAddFile").remove();""==RoxyFilemanConf.DOWNLOAD&&($("#mnuDownload").next().remove(),$("#mnuDownload").remove());""==RoxyFilemanConf.DOWNLOADDIR&&($("#mnuDownloadDir").next().remove(),$("#mnuDownloadDir").remove());""==RoxyFilemanConf.DELETEFILE&&($("#mnuDeleteFile").prev().remove(),
$("#mnuDeleteFile").remove(),$("#btnDeleteFile").remove());""==RoxyFilemanConf.MOVEFILE&&($("#mnuFileCut").next().remove(),$("#mnuFileCut").remove());""==RoxyFilemanConf.COPYFILE&&($("#mnuFileCopy").next().remove(),$("#mnuFileCopy").remove());""==RoxyFilemanConf.COPYFILE&&""==RoxyFilemanConf.MOVEFILE&&($("#mnuFilePaste").next().remove(),$("#mnuFilePaste").remove());""==RoxyFilemanConf.RENAMEFILE&&($("#mnuRenameFile").next().remove(),$("#mnuRenameFile").remove(),$("#btnRenameFile").remove())}
function getPreselectedFile(){var a=RoxyUtils.GetUrlParam("selected");if(!a)switch(getFilemanIntegration()){case "ckeditor":try{var b=window.opener.CKEDITOR.dialog.getCurrent(),a=b.getValueOf("info","link"==b.getName()?"url":"txtUrl")}catch(d){}break;case "tinymce3":try{var c=tinyMCEPopup.getWindowArg("window"),a=c.document.getElementById(tinyMCEPopup.getWindowArg("input")).value;0==a.indexOf("..")&&(a=a.substr(2))}catch(d){}break;case "tinymce4":try{c=window.opener?window.opener:window.parent,a=
c.document.getElementById(RoxyUtils.GetUrlParam("input")).value,0==a.indexOf("..")&&(a=a.substr(2))}catch(d){}break;default:a=GetSelectedValue()}RoxyFilemanConf.RETURN_URL_PREFIX&&(b=RoxyFilemanConf.RETURN_URL_PREFIX,0==a.indexOf(b)&&("/"==b.substr(-1)&&(b=b.substr(0,b.length-1)),a=a.substr(b.length)));return a}
function initSelection(a){var b=!1,c=!0;a||(a=getPreselectedFile());!a&&RoxyUtils.ToBool(RoxyFilemanConf.OPEN_LAST_DIR)&&(a=getLastDir(),c=!1);if(a){c=c?RoxyUtils.GetPath(a):a;c=tmp=Directory.Parse(c);do tmp&&(tmp.Expand(!0),b=!0),tmp=Directory.Parse(tmp.path);while(tmp);c&&(c.Select(a),b=!0)}b||selectFirst()}
$(function(){RoxyUtils.LoadConfig();(new Directory).LoadAll();$("#wraper").show();window.setTimeout("initSelection()",100);RoxyUtils.Translate();$("body").click(function(){closeMenus()});var a=RoxyUtils.GetCookie("roxyview");a||(a=RoxyFilemanConf.DEFAULTVIEW);a&&switchView(a);ResizeLists();$(".actions input").tooltip({track:!0});$(window).resize(ResizeLists);document.oncontextmenu=function(){return!1};removeDisabledActions();$("#copyYear").html((new Date).getFullYear());RoxyFilemanConf.UPLOAD&&""!=
RoxyFilemanConf.UPLOAD&&(a=document.getElementById("fileActions"),a.ondragover=function(){return!1},a.ondragend=function(){return!1},a.ondrop=function(a){a.preventDefault();a.stopPropagation();dropFiles(a)},a=document.getElementById("dlgAddFile"),a.ondragover=function(){return!1},a.ondragend=function(){return!1},a.ondrop=function(a){a.preventDefault();a.stopPropagation();dropFiles(a,!0)});if("tinymce3"==getFilemanIntegration())try{$("body").append('<script src="js/tiny_mce_popup.js">\x3c/script>')}catch(b){}});
function getFilemanIntegration(){var a=RoxyUtils.GetUrlParam("integration");a||(a=RoxyFilemanConf.INTEGRATION);return a.toLowerCase()}
function setFile(){var a=getSelectedFile();if(a){var b=a.fullPath;if(RoxyFilemanConf.RETURN_URL_PREFIX){var c=RoxyFilemanConf.RETURN_URL_PREFIX;"/"==c.substr(-1)&&(c=c.substr(0,c.length-1));b=c+("/"!=b.substr(0,1)?"/":"")+b}switch(getFilemanIntegration()){case "ckeditor":window.opener.CKEDITOR.tools.callFunction(RoxyUtils.GetUrlParam("CKEditorFuncNum"),encodeURI(b));self.close();break;case "tinymce3":a=tinyMCEPopup.getWindowArg("window");a.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=
b;"undefined"!=typeof a.ImageDialog&&(a.ImageDialog.getImageData&&a.ImageDialog.getImageData(),a.ImageDialog.showPreviewImage&&a.ImageDialog.showPreviewImage(b));tinyMCEPopup.close();break;case "tinymce4":a=window.opener?window.opener:window.parent;a.document.getElementById(RoxyUtils.GetUrlParam("input")).value=b;"undefined"!=typeof a.ImageDialog&&(a.ImageDialog.getImageData&&a.ImageDialog.getImageData(),a.ImageDialog.showPreviewImage&&a.ImageDialog.showPreviewImage(b));a.tinyMCE.activeEditor.windowManager.close();
break;default:FileSelected(a)}}else alert(t("E_NoFileSelected"))};